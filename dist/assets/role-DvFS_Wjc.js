import{e as h,j as t,D as k}from"./index-DCRMDEnN.js";import{r}from"./react-dom-B_KBoKIY.js";import{s as E}from"./index-D8YrEZpJ.js";import{P as C}from"./ProCard-Dqfv741k.js";import{P as p,a as I,b as _}from"./Table-DyPCT7V2.js";import{P as D}from"./index-Ctq1ZWD9.js";import{W as f}from"./index-DnOj4hun.js";import{B as n}from"./button-DEnRpW9g.js";import"./index-CDqw0lfA.js";import"./FileOutlined-l9Qrf-hC.js";import"./FolderOutlined-DdSHhABZ.js";import"./progress-Cp_dByrN.js";import"./index-BvlifVVu.js";import"./index-CmozH8WR.js";import"./index-CoWpGy66.js";function H(){const[s,u]=E.useMessage(),y=[{title:"角色名",dataIndex:"name",key:"name"},{title:"操作",key:"action",render:(o,e)=>t.jsxs(t.Fragment,{children:[t.jsx(n,{onClick:()=>S(e),style:{marginRight:8},children:"编辑"}),t.jsx(_,{title:"确定要删除用户吗?",onConfirm:()=>{g(e)},children:t.jsx(n,{children:"删除"})})]})}],g=o=>{s.open({type:"loading",content:"删除角色: "+o.name+"中"}),fetch(h.API_URL+"/api/v1/auth/role?name="+o.name,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("SESSION")||""}}).then(async e=>{if(!e.ok&&e.status===401){const i=await e.json();i.msg&&(s.destroy(),s.error(i.msg))}return e.json()}).then(e=>{e.status===0?(s.success("删除角色: "+o.name+"成功"),m(c.filter(i=>i.name!==o.name)),s.destroy()):s.error(e.message)}).catch(e=>{console.error("Error:",e)})},x=[{title:"方法",dataIndex:"method",key:"method"},{title:"路径",dataIndex:"path",key:"path"},{title:"操作",key:"action",render:(o,e)=>t.jsx(n,{onClick:()=>w(e),children:"删除"})}],[c,m]=r.useState([]),[j,d]=r.useState(!1),[a,l]=r.useState(null);r.useEffect(()=>{fetch(h.API_URL+"/api/v1/auth/role",{method:"GET",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("SESSION")||""}}).then(o=>{o.ok&&o.json().then(e=>{m(e)})})},[]);const S=o=>{l(o),d(!0)},P=()=>{d(!1)},w=o=>{a&&l({...a,policy_list:a.policy_list.filter(e=>e.path!==o.path)})},b=o=>{a&&l({...a,policy_list:[...a.policy_list,o]})};return t.jsxs(t.Fragment,{children:[u,t.jsxs(C,{children:[t.jsx(p,{columns:y,dataSource:c,rowKey:"name",pagination:{showQuickJumper:!0,pageSize:5},search:!1,toolbar:{style:{padding:0,height:0}}}),a&&t.jsxs(k,{title:`策略详情 - ${a.name}`,placement:"right",onClose:P,visible:j,width:500,children:[t.jsx(p,{columns:x,dataSource:a.policy_list,rowKey:"path",pagination:!1,search:!1,toolbar:{style:{padding:0,height:0}}}),t.jsxs(D,{onFinish:b,submitter:!1,children:[t.jsxs(I,{name:"newPolicy",style:{marginBottom:24},children:[t.jsx(f,{width:"md",name:"method",label:"方法",placeholder:"请输入方法"}),t.jsx(f,{width:"md",name:"path",label:"路径",placeholder:"请输入路径"})]}),t.jsx(n,{htmlType:"submit",children:"添加策略"})]})]})]})]})}export{H as default};
